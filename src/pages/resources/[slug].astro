---
import Layout from "@/layouts/Layout.astro";
import { getCollection } from "astro:content";

// Build all resource pages at build time (skip drafts)
export async function getStaticPaths() {
  const entries = await getCollection("resources", (entry) => entry.data?.draft !== true);
  return entries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();
const fm = entry.data;

// Frontmatter for <Layout> meta/LD+JSON
const frontmatter = {
  title: fm.title ?? "Resource",
  description: fm.description ?? "",
  publishDate: fm.publishDate,
  updatedDate: fm.updatedDate,
  schemaType: "TechArticle", // or "Article"
};
---

<Layout frontmatter={frontmatter}>
  <section class="prose max-w-3xl mx-auto py-8">
    <h1>{fm.title}</h1>
    {fm.description && <p><em>{fm.description}</em></p>}

    <Content />

    {Array.isArray(fm.tags) && fm.tags.length > 0 && (
      <p><strong>Tags:</strong> {fm.tags.join(", ")}</p>
    )}
  </section>
</Layout>

