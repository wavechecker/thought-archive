---
import { getCollection } from "astro:content";

// MDX components used inside posts
import StratBox from "../../components/StratBox.astro";
import EvidenceBox from "../../components/EvidenceBox.astro";

// Backwards-compat alias (in case any older content uses <StatBox />)
const mdxComponents = {
  StratBox,
  EvidenceBox,
  StatBox: StratBox,
};

export async function getStaticPaths() {
  const posts = await getCollection("posts");
  return posts.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;

// KEY: entry.render() is the reliable path for MDX + components
const { Content } = await entry.render();
---

<html lang="en">
  <head>
    <title>{entry.data.title}</title>
    {entry.data.description && (
      <meta name="description" content={entry.data.description} />
    )}
  </head>

  <body>
    <main class="prose dark:prose-invert max-w-3xl mx-auto px-4 py-10">
      <h1>{entry.data.title}</h1>

      {entry.data.publishDate && (
        <p class="text-sm text-gray-500">
          Published: {entry.data.publishDate}
        </p>
      )}

      <Content components={mdxComponents} />
    </main>
  </body>
</html>
