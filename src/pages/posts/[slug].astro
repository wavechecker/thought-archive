---
import Layout from "@/layouts/Layout.astro";
import { getCollection, getEntryBySlug } from "astro:content";
import { isValidDate, fmt } from "@/lib/date";

export const prerender = true;

// Build-time paths for all posts
export async function getStaticPaths() {
  const entries = await getCollection("posts");
  return entries.map((e) => ({ params: { slug: e.slug } }));
}

const { slug } = Astro.params;
const entry = await getEntryBySlug("posts", slug);
if (!entry) return Astro.redirect("/404");

// Astro v5: use entry.data for frontmatter
const { Content } = await entry.render();
const data = entry.data;

const canonical = `https://patientguide.io/posts/${entry.slug}/`;
---

<Layout frontmatter={data}>
  <h1>{data?.title ?? "Untitled"}</h1>
  <p style="color:#6b7280; margin-top:.25rem;">
    {data?.publishDate && isValidDate(data.publishDate) ? fmt(data.publishDate) : ""}
    {data?.updatedDate && ` â€¢ Updated ${fmt(data.updatedDate)}`}
  </p>
  <Content />
  {data?.tags?.length > 0 && (
    <p style="color:#2563eb; margin-top:1rem;">
      {data.tags.map((t, i) => `#${t}${i < data.tags.length - 1 ? " " : ""}`)}
    </p>
  )}
</Layout>


