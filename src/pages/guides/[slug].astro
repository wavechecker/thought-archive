---
import { getEntryBySlug } from "astro:content";
import { isValidDate, fmt } from "@/lib/date";

// Pull the slug from the URL
const { slug } = Astro.params;

// Fetch the content entry
const guide = await getEntryBySlug("guides", slug);

if (!guide) {
  throw new Error(`Guide not found for slug: ${slug}`);
}

// Destructure for convenience
const { Content, data } = guide;

// Pick the best available date
const displayDate = isValidDate(data.publishDate)
  ? data.publishDate
  : isValidDate(data.updatedDate)
    ? data.updatedDate
    : undefined;
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>{data.title} â€¢ PatientGuide</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>
  <body>
    <article>
      <h1>{data.title}</h1>
      {displayDate && (
        <p>
          <time datetime={displayDate.toISOString()}>{fmt(displayDate)}</time>
        </p>
      )}
      <Content />
    </article>
  </body>
</html>

