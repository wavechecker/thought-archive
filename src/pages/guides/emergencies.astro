---
import Layout from "@/layouts/Layout.astro";
import { getCollection } from "astro:content";

const all = await getCollection("guides");
const norm = (s) => (s ?? "").toLowerCase();

const isEmergency = (e) => {
  const cat = norm(e.data?.category);
  const tags = (e.data?.tags ?? []).map(norm);
  return (
    cat === "emergencies" ||
    tags.includes("emergency") ||
    tags.includes("emergencies") ||
    tags.includes("urgent") ||
    tags.includes("first aid")
  );
};

const items = all
  .filter((e) => !e.data?.draft)
  .filter(isEmergency)
  .sort((a, b) => new Date(b.data?.publishDate ?? 0) - new Date(a.data?.publishDate ?? 0));

const linkFor = (e) => `/guides/${e.slug}/`;
---

<Layout frontmatter={{ title: "Emergencies — Guide Hub", description: "When to act fast and how." }}>
  <h1>Emergencies — Guide Hub</h1>
  {items.length === 0 ? (
    <p>No emergency guides found.</p>
  ) : (
    <ul>
      {items.map((g) => (
        <li>
          <a href={linkFor(g)}>{g.data.title}</a>
          {g.data?.description && <> — {g.data.description}</>}
        </li>
      ))}
    </ul>
  )}
</Layout>

