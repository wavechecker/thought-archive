---
import { getCollection } from "astro:content";

// MDX components used inside guides
import StratBox from "../../components/StratBox.astro";
import EvidenceBox from "../../components/EvidenceBox.astro";

// Optional: keep your StatBox backwards-compat working
// (in case older guides use <StatBox />)
const mdxComponents = {
  StratBox,
  EvidenceBox,
  StatBox: StratBox,
};

export async function getStaticPaths() {
  const guides = await getCollection("guides");
  return guides.map((entry) => ({
    params: { slug: entry.slug }, // IMPORTANT: string for [...slug]
    props: { entry },
  }));
}

const { entry } = Astro.props;

// This is the key: use entry.render() (not render() import)
const { Content } = await entry.render();
---

<html lang="en">
  <head>
    <title>{entry.data.title}</title>
    {entry.data.description && (
      <meta name="description" content={entry.data.description} />
    )}
  </head>

  <body>
    <main class="prose dark:prose-invert max-w-3xl mx-auto px-4 py-10">
      <h1>{entry.data.title}</h1>

      {entry.data.publishDate && (
        <p class="text-sm text-gray-500">
          Published: {entry.data.publishDate}
        </p>
      )}

      <Content components={mdxComponents} />
    </main>
  </body>
</html>
