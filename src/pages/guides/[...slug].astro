---
import { getCollection } from "astro:content";
import Base from "../../layouts/Base.astro";
import { isValidDate, fmt } from "@/lib/date";

// MDX components used inside guides
import StratBox from "../../components/StratBox.astro";
import EvidenceBox from "../../components/EvidenceBox.astro";

// Optional: keep your StatBox backwards-compat working
// (in case older guides use <StatBox />)
const mdxComponents = {
  StratBox,
  EvidenceBox,
  StatBox: StratBox,
};

export async function getStaticPaths() {
  const guides = await getCollection("guides");
  return guides.map((entry) => ({
    params: { slug: entry.slug }, // IMPORTANT: string for [...slug]
    props: { entry },
  }));
}

const { entry } = Astro.props;

// This is the key: use entry.render() (not render() import)
const { Content } = await entry.render();

const { title, description, publishDate, updatedDate } = entry.data;
---

<Base title={title} description={description}>
  <article class="prose dark:prose-invert max-w-3xl mx-auto">
    <h1>{title}</h1>

    {publishDate && (
      <p class="text-sm opacity-70">
        Published: {isValidDate(publishDate) ? fmt(publishDate) : publishDate}
        {updatedDate && updatedDate !== publishDate && (
          <> Â· Updated: {isValidDate(updatedDate) ? fmt(updatedDate) : updatedDate}</>
        )}
      </p>
    )}

    <Content components={mdxComponents} />
  </article>
</Base>
