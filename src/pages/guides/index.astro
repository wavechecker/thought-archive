---
import Layout from "../../layouts/Layout.astro";
import { getCollection } from "astro:content";

// Pull all guides
const all = await getCollection("guides");

// Allowed categories that have real hub pages
const ALLOWED = ["Type 1 Diabetes", "Type 2 Diabetes", "Heart & Circulation", "Bowel Cancer"];

// Group by category/tag, skip drafts and uncategorised ("Other")
const groups = new Map<string, typeof all>();
for (const e of all) {
  if (e.data?.draft === true) continue;
  const cat =
    (typeof e.data?.category === "string" && e.data.category.trim()) ||
    (Array.isArray(e.data?.tags) ? e.data.tags.find(t => ALLOWED.includes(t)) : undefined);
  if (!cat || !ALLOWED.includes(cat)) continue; // ðŸ‘‰ hides "Other" and "Diabetes"
  if (!groups.has(cat)) groups.set(cat, []);
  groups.get(cat)!.push(e);
}

// Map categories to hub URLs (no "Diabetes" on purpose)
const hubMap = new Map<string, string>([
  ["Type 1 Diabetes", "/guides/type-1-diabetes"],
  ["Type 2 Diabetes", "/guides/type-2-diabetes"],
  ["Heart & Circulation", "/guides/heart-circulation"],
  ["Bowel Cancer", "/guides/bowel-cancer"],
]);

const orderedCats = Array.from(groups.keys()).sort((a, b) => a.localeCompare(b));

const frontmatter = {
  title: "Guides â€” PatientGuide",
  description: "Browse all patient-friendly guides by category. Hubs stay in sync automatically.",
  publishDate: "2025-08-21",
  draft: false,
  tags: ["guides", "patientguide"],
};
---

<Layout {frontmatter}>
  <h1 class="text-3xl font-bold mb-6">Guide Hubs</h1>
  <p class="mb-8 text-lg text-gray-700">
    Categories below update automatically as you add or edit guides. Click a hub to explore.
  </p>

  <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
    {orderedCats.map((cat) => {
      const list = groups.get(cat) ?? [];
      const href = hubMap.get(cat)!; // guaranteed by ALLOWED filter
      return (
        <a href={href} class="block p-6 rounded-2xl shadow hover:shadow-lg transition bg-white">
          <h2 class="text-xl font-semibold mb-1">{cat} â€” Guide Hub</h2>
          <p class="text-gray-600 text-sm mb-3">Browse focused guides in this hub.</p>
          <p class="text-gray-800 text-sm">{list.length} guide{list.length === 1 ? "" : "s"}</p>
        </a>
      );
    })}
  </div>
</Layout>



