---
import Layout from "@/layouts/Layout.astro";
import { getCollection } from "astro:content";

const site = Astro.site?.toString().replace(/\/+$/, "") || "https://patientguide.io";
const pageUrl = `${site}/guides/respiratory`;

const title = "Respiratory — Guides";
const description = "Guides for breathing and airway health: asthma, COPD, sleep apnoea, shortness of breath, and related symptoms.";

const guides = (await getCollection("guides", ({ data }) =>
  data?.draft !== true && (data?.category === "Respiratory" || data?.category === "respiratory")
)).sort((a, b) => (a.data?.title || "").localeCompare(b.data?.title || ""));

const breadcrumbLd = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  itemListElement: [
    { "@type": "ListItem", position: 1, name: "Guides", item: `${site}/guides` },
    { "@type": "ListItem", position: 2, name: "Respiratory", item: pageUrl }
  ]
};

const collectionPageLd = {
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  name: title,
  description,
  url: pageUrl,
  inLanguage: "en",
  isPartOf: { "@type": "WebSite", name: "patientguide.io", url: site }
};
---

<Layout title={title} description={description}>
  <section class="prose max-w-3xl mx-auto py-8">
    <h1>{title}</h1>
    <p>{description}</p>

    {guides.length === 0 ? (
      <p>No guides found yet.</p>
    ) : (
      <ul class="list-disc list-inside mt-6 space-y-2">
        {guides.map((g) => (
          <li>
            <a href={`/guides/${g.slug}`}>{g.data?.title ?? "(Untitled)"}</a>
            {g.data?.description && <small> — {g.data.description}</small>}
          </li>
        ))}
      </ul>
    )}
  </section>

  <script type="application/ld+json" set:html={JSON.stringify(breadcrumbLd)} />
  <script type="application/ld+json" set:html={JSON.stringify(collectionPageLd)} />
</Layout>
