---
import { getCollection } from 'astro:content';

const posts = await getCollection('posts', (p) => !p.data.draft);
const tagMap = new Map<string, number>();

for (const p of posts) {
  const t = Array.isArray(p.data.tags) ? p.data.tags : [];
  for (const tag of t) {
    const key = String(tag).toLowerCase();
    tagMap.set(key, (tagMap.get(key) ?? 0) + 1);
  }
}

const tags = Array.from(tagMap.entries())
  .sort((a, b) => b[1] - a[1]); // by count desc
---

<html lang="en">
  <head>
    <title>Tags â€” Thought-Archive</title>
    <meta name="description" content="Browse posts by tag." />
  </head>
  <body>
    <main class="max-w-3xl mx-auto px-4 py-10">
      <h1 class="text-3xl font-bold mb-6">Tags</h1>
      {tags.length === 0 ? (
        <p>No tags yet.</p>
      ) : (
        <ul class="grid grid-cols-2 gap-3">
          {tags.map(([tag, count]) => (
            <li>
              <a class="underline" href={`/tags/${encodeURIComponent(tag)}`}>
                {tag} ({count})
              </a>
            </li>
          ))}
        </ul>
      )}
    </main>
  </body>
</html>
