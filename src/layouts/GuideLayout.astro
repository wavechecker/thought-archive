---
/**
 * GuideLayout.astro
 * Renders one guide page with SEO + JSON-LD:
 *  - Article/WebPage (always)
 *  - MedicalCondition, Device, Procedure, Symptom (conditional)
 *  - FAQPage + BreadcrumbList
 *  - schema (custom JSON-LD from frontmatter)
 */
import { isValidDate } from "@/lib/date.ts";

const {
  title,
  description,
  category,
  publishDate,
  updatedDate,
  tags = [],
  heroImage = "/images/lada-guide-hero.jpg",

  // Structured inputs
  faq = [],
  sameAs = [],
  breadcrumbs = [],
  schema = {}, // <- now supports generic JSON-LD object
} = Astro.props;

// Dates
const pub = isValidDate(publishDate) ? publishDate : undefined;
const mod = isValidDate(updatedDate) ? updatedDate : pub;

// Canonical URL
const site = Astro.site?.toString().replace(/\/+$/, "") ?? "https://patientguide.io";
const canonicalPath = Astro.url.pathname.replace(/\/+$/, "") || "/guides";
const canonicalUrl = `${site}${canonicalPath}`;

// Hero image â†’ absolute
const heroAbs = heroImage
  ? (heroImage.startsWith("http") ? heroImage : `${site}${heroImage}`)
  : undefined;

// Breadcrumbs
const bc = breadcrumbs.length
  ? breadcrumbs
  : [
      { name: "Guides", url: `${site}/guides` },
      { name: category ?? "General", url: `${site}/guides?category=${encodeURIComponent(category ?? "General")}` },
      { name: title ?? "Guide", url: canonicalUrl },
    ];

/* ------------------------- JSON-LD builders ------------------------- */

// 1) Article/WebPage
const articleLd = {
  "@context": "https://schema.org",
  "@type": ["Article", "WebPage"],
  "mainEntityOfPage": { "@type": "WebPage", "@id": canonicalUrl },
  "headline": title,
  "description": description ?? "",
  "keywords": Array.isArray(tags) && tags.length ? tags : undefined,
  "datePublished": pub ?? undefined,
  "dateModified": mod ?? undefined,
  "author": { "@type": "Organization", "name": "patientguide.io", "url": site },
  "publisher": {
    "@type": "Organization",
    "name": "patientguide.io",
    "logo": { "@type": "ImageObject", "url": `${site}/logo.png` },
  },
  "isPartOf": {




